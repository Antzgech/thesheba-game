<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Saba Gift - Tap to Earn</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="app">
    <!-- Top Stats Bar -->
    <div class="top-bar">
      <div class="stat-item">
        <span class="stat-label">Balance</span>
        <div id="coins" class="coins">0</div>
      </div>
      <div class="stat-item">
        <span class="stat-label">Level</span>
        <div id="level" class="level-badge">1</div>
      </div>
    </div>

    <!-- Main Content Container -->
    <div class="content-container">
      <!-- Home Section -->
      <section id="homeSection" class="section active">
        <div class="home-content">
          <div class="balance-display">
            <div class="balance-icon">üéÅ</div>
            <div id="coinsDisplay" class="balance-amount">0</div>
            <div class="balance-label">Saba Gifts</div>
          </div>

          <div class="tap-container">
            <div class="tap-area" id="tapArea">
              <div class="tap-circle">
                <span class="tap-emoji">üéÅ</span>
              </div>
              <div class="tap-glow"></div>
            </div>
            <div id="clickAnimations" class="click-animations"></div>
          </div>

          <div class="energy-container">
            <div class="energy-header">
              <div class="energy-info">
                <span class="energy-icon">‚ö°</span>
                <span id="energyText" class="energy-text">10/10</span>
              </div>
              <span class="energy-regen">+1/sec</span>
            </div>
            <div class="energy-bar">
              <div id="energyFill" class="energy-fill"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mine Section -->
      <section id="mineSection" class="section">
        <div class="section-header">
          <h2>‚õèÔ∏è Mine</h2>
          <p class="section-subtitle">Upgrade your earning power</p>
        </div>
        <div id="upgrades" class="upgrades-grid"></div>
      </section>

      <!-- Earn Section -->
      <section id="earnSection" class="section">
        <div class="section-header">
          <h2>üí∞ Earn More</h2>
          <p class="section-subtitle">Complete tasks and get rewards</p>
        </div>
        
        <div class="tasks-container">
          <div class="task-card daily-reward">
            <div class="task-icon">üéÅ</div>
            <div class="task-info">
              <div class="task-title">Daily Reward</div>
              <div class="task-reward">+50 Gifts</div>
            </div>
            <button class="task-btn" onclick="claimDailyReward()">Claim</button>
          </div>

          <div class="task-card">
            <div class="task-icon">üë•</div>
            <div class="task-info">
              <div class="task-title">Invite 3 Friends</div>
              <div class="task-reward">+25,000 Gifts</div>
            </div>
            <div class="task-status">0/3</div>
          </div>

          <div class="task-card">
            <div class="task-icon">üì±</div>
            <div class="task-info">
              <div class="task-title">Join Telegram Channel</div>
              <div class="task-reward">+100 Gifts</div>
            </div>
            <button class="task-btn" onclick="joinChannelReward()">Join</button>
          </div>

          <div class="task-card">
            <div class="task-icon">üé¨</div>
            <div class="task-info">
              <div class="task-title">Subscribe YouTube Channel</div>
              <div class="task-reward">+200 Gifts</div>
            </div>
            <button class="task-btn" onclick="subscribeChannelReward()">Subscribe</button>
          </div>
        </div>
      </section>

      <!-- Friends Section -->
      <section id="friendsSection" class="section">
        <div class="section-header">
          <h2>üë• Invite Friends</h2>
          <p class="section-subtitle">Get 10% from friends + 2.5% from their referrals</p>
        </div>

        <div class="referral-card">
          <div class="referral-header">
            <span class="referral-label">Your Referral Link</span>
          </div>
          <div class="referral-link-box">
            <div id="referralLink" class="referral-link"></div>
          </div>
          <div class="referral-actions">
            <button class="btn-primary" onclick="copyReferral()">
              <span>üìã</span> Copy Link
            </button>
            <button class="btn-secondary" onclick="shareReferral()">
              <span>üì§</span> Share
            </button>
          </div>
        </div>

        <div class="friends-card">
          <div class="friends-header">
            <h3>Your Friends</h3>
            <span id="friendsCount" class="friends-count">0</span>
          </div>
          <div id="friendsContainer" class="friends-list">
            <div class="empty-state">
              <div class="empty-icon">üë•</div>
              <div class="empty-text">No friends invited yet</div>
              <div class="empty-subtext">Share your link to get started!</div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <button class="nav-item active" data-section="home">
        <span class="nav-icon">üéÅ</span>
        <span class="nav-label">Home</span>
      </button>
      <button class="nav-item" data-section="mine">
        <span class="nav-icon">‚õèÔ∏è</span>
        <span class="nav-label">Mine</span>
      </button>
      <button class="nav-item" data-section="earn">
        <span class="nav-icon">üí∞</span>
        <span class="nav-label">Earn</span>
      </button>
      <button class="nav-item" data-section="friends">
        <span class="nav-icon">üë•</span>
        <span class="nav-label">Friends</span>
      </button>
    </nav>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script src="script.js"></script>
  <!-- Add this modal HTML before closing </body> tag in index.html -->

<!-- Phone Registration Modal -->
<div id="phoneModal" class="phone-modal" style="display: none;">
  <div class="phone-modal-content">
    <div class="phone-modal-header">
      <h2>üì± Register Phone Number</h2>
      <p>Required to claim weekly airtime rewards!</p>
    </div>
    
    <div class="phone-modal-body">
      <div class="reward-info">
        <div class="reward-icon">üèÜ</div>
        <div class="reward-text">
          <strong>Top 10 players each week win!</strong>
          <div class="reward-amount">25 ETB Ethiotelecom Airtime</div>
        </div>
      </div>
      
      <form id="phoneForm" onsubmit="submitPhoneNumber(event)">
        <div class="form-group">
          <label for="phoneInput">Phone Number</label>
          <input 
            type="tel" 
            id="phoneInput" 
            placeholder="09XXXXXXXX" 
            pattern="09[0-9]{8}" 
            required
            maxlength="10"
          />
          <small>Format: 09XXXXXXXX (Ethiopian number)</small>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closePhoneModal()">Later</button>
          <button type="submit" class="btn-submit">Register</button>
        </div>
      </form>
      
      <div class="requirements">
        <p><strong>Requirements to win:</strong></p>
        <ul>
          <li>‚úÖ Be in Top 10 leaderboard</li>
          <li>‚úÖ Subscribe to YouTube channel</li>
          <li>‚úÖ Join Telegram channel</li>
          <li>‚úÖ Register phone number</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<style>
/* Phone Modal Styles - Add to styles.css */
.phone-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadeIn 0.3s ease;
}

.phone-modal-content {
  background: linear-gradient(135deg, #667eea, #764ba2);
  border-radius: 24px;
  max-width: 500px;
  width: 100%;
  overflow: hidden;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.phone-modal-header {
  padding: 30px;
  text-align: center;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
}

.phone-modal-header h2 {
  color: white;
  font-size: 28px;
  margin-bottom: 8px;
}

.phone-modal-header p {
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
}

.phone-modal-body {
  padding: 30px;
  background: white;
}

.reward-info {
  background: linear-gradient(135deg, #fff3cd, #ffeaa7);
  padding: 20px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 25px;
}

.reward-icon {
  font-size: 48px;
}

.reward-text strong {
  display: block;
  color: #333;
  font-size: 16px;
  margin-bottom: 5px;
}

.reward-amount {
  color: #667eea;
  font-size: 24px;
  font-weight: 700;
}

.form-group {
  margin-bottom: 25px;
}

.form-group label {
  display: block;
  color: #333;
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 14px;
}

.form-group input {
  width: 100%;
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 16px;
  transition: all 0.3s;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group small {
  display: block;
  color: #999;
  font-size: 12px;
  margin-top: 5px;
}

.form-actions {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 10px;
}

.btn-cancel, .btn-submit {
  padding: 15px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-cancel {
  background: #f0f0f0;
  color: #666;
}

.btn-cancel:hover {
  background: #e0e0e0;
}

.btn-submit {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
}

.requirements {
  margin-top: 20px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 12px;
}

.requirements p {
  color: #333;
  font-weight: 600;
  margin-bottom: 10px;
}

.requirements ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.requirements li {
  color: #666;
  padding: 5px 0;
  font-size: 14px;
}
</style>

<script>
// Phone Modal Functions - Add to script.js

function showPhoneModal() {
  document.getElementById('phoneModal').style.display = 'flex';
}

function closePhoneModal() {
  document.getElementById('phoneModal').style.display = 'none';
  // Save that user dismissed it
  localStorage.setItem(`phoneModalDismissed_${userId}`, 'true');
}

async function submitPhoneNumber(event) {
  event.preventDefault();
  
  const phoneInput = document.getElementById('phoneInput');
  const phone = phoneInput.value.trim();
  
  // Validate format
  if (!/^09[0-9]{8}$/.test(phone)) {
    showToast('‚ùå Invalid phone format! Use: 09XXXXXXXX');
    return;
  }
  
  try {
    const response = await fetch(`${API_BASE_URL}/api/user/${userId}/update_contact`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        phone_number: phone,
        username: userName
      })
    });
    
    if (response.ok) {
      showToast('‚úÖ Phone number registered successfully!');
      closePhoneModal();
      
      // Save that user completed registration
      localStorage.setItem(`phoneRegistered_${userId}`, 'true');
      
      // Show success message
      setTimeout(() => {
        showToast('üéâ You\'re now eligible for weekly airtime rewards!');
      }, 2000);
    } else {
      showToast('‚ùå Failed to register phone number. Try again.');
    }
  } catch (error) {
    console.error('Phone registration error:', error);
    showToast('‚ùå Connection error. Please try again.');
  }
}

// Show modal when user reaches 1000 coins (add to init function)
function checkAndShowPhoneModal() {
  // Don't show if already registered or dismissed
  const dismissed = localStorage.getItem(`phoneModalDismissed_${userId}`);
  const registered = localStorage.getItem(`phoneRegistered_${userId}`);
  
  if (dismissed || registered) {
    return;
  }
  
  // Show modal when user reaches 1000 coins
  if (gameState.coins >= 1000) {
    setTimeout(() => {
      showPhoneModal();
    }, 2000);
  }
}

// Call this after coins update
// Add to updateCoins() function:
// checkAndShowPhoneModal();
</script>
</body>
</html>

